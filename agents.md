Pipeline Contols


| **Security Control**                         | **Description**                                                                                   | **CIS Docker Benchmark**                    | **CIS Kubernetes Benchmark**                | **CIS Amazon EKS Benchmark**                | **Implementable Control**                                                                                                      | **Preventive/Detective**                    | **Steps for Implementation**                                                                                                                                                       |
|----------------------------------------------|---------------------------------------------------------------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Least Privilege Principle                    | Ensure agents have minimal permissions necessary for tasks.                                        | 4.2 (Restrict container privileges)        | 5.1.5 (Limit capabilities)                | 3.3 (IAM policies)                         | Define and enforce least privilege policies for all agents. Use RBAC to assign minimal permissions.                               | Preventive                                  | 1. Define roles and permissions. 2. Assign least privilege roles to agents. 3. Implement RBAC for Kubernetes and IAM for EC2. 4. Regularly review and adjust permissions.         |
| Run Agents on Secure Infrastructure          | Host agents on secure, isolated environments (dedicated VMs/containers).                           | 1.1 (Host configuration)                   | 1.1.1 (Control plane hardening)            | 3.2 (VPC and security groups)              | Deploy agents in isolated environments with strict access controls.                                                            | Preventive                                  | 1. Provision dedicated VMs or containers for agents. 2. Implement network segmentation using VPCs and security groups. 3. Apply strict access controls to these environments.     |
| Agent Pool Segmentation                      | Use separate agent pools for different projects/environments.                                      | 5.20 (Use a container orchestrator)        | 2.2 (RBAC and namespaces)                  | 3.3.3 (Segregate environments)             | Segregate agent pools based on environments (development, staging, production) to limit access and reduce risk.                 | Preventive                                  | 1. Create separate agent pools for different environments. 2. Apply RBAC to each pool to restrict access. 3. Ensure isolated networking between different agent pools.            |
| Agent Authentication                         | Use strong authentication mechanisms for agents (OAuth, PAT).                                      | 2.1 (Auth for Docker daemon)               | 1.1.4 (Secure API server)                  | 4.1 (IAM roles for service accounts)       | Implement strong authentication and enforce short-lived credentials for agent authentication.                                    | Preventive                                  | 1. Use token-based or certificate-based authentication. 2. Implement short-lived credentials. 3. Configure agents to use secure authentication methods. 4. Regularly rotate credentials.|
| Secure Agent Communication                   | Encrypt communications between agents and servers (TLS/SSL).                                       | 2.5 (Enable TLS)                           | 1.1.2 (API server encryption)              | 4.1 (KMS encryption)                       | Ensure all communications between agents and servers are encrypted using TLS/SSL.                                                | Preventive                                  | 1. Configure agents to use TLS/SSL for all communications. 2. Install and manage certificates securely. 3. Regularly update TLS/SSL configurations.                             |
| Regular Updates and Patching                 | Keep agent software and OS up to date with security patches.                                       | 3.2 (Image patch management)               | 6.1 (Update Kubernetes components)         | 6.1 (Update and patch EKS)                 | Regularly update and patch the OS and software on agent hosts to protect against vulnerabilities.                                | Preventive                                  | 1. Implement automated patch management tools. 2. Schedule regular patching cycles. 3. Test patches in a staging environment before deployment. 4. Monitor for patch failures.  |
| Environment Variable Management              | Store sensitive information in secure files or variables.                                          | 5.4 (Environment variables)                | 5.4 (Limit secrets exposure)               | 5.1 (Secrets management)                   | Store sensitive information, such as credentials, in secure, encrypted files or environment variables.                           | Preventive                                  | 1. Use encrypted environment variables or secure files for sensitive data. 2. Limit access to these variables/files. 3. Regularly rotate sensitive information.                    |
| Logging and Monitoring                       | Enable comprehensive logging and monitoring of agent activities.                                   | 4.4 (Logging)                              | 4.2.1 (Enable audit logging)               | 4.1 (CloudWatch and logging)               | Enable detailed logging of all agent activities and monitor logs regularly to detect and respond to suspicious behavior.         | Detective                                   | 1. Implement centralized logging tools. 2. Configure agents to log all critical activities. 3. Set up alerts for suspicious activities. 4. Regularly review and analyze logs.      |
| Network Security                             | Restrict network access using firewall rules or network security groups.                           | 3.15 (Network policies)                    | 5.1.3 (Network policies)                   | 3.2 (VPC and security groups)              | Implement strict network policies and firewall rules to limit inbound and outbound traffic to only what is necessary for agents.| Preventive                                  | 1. Define and implement firewall rules and network policies. 2. Segment network traffic using VPCs and security groups. 3. Regularly review and update network rules.            |
| Agent Auto-Scaling and Cleanup               | Implement policies for auto-scaling and cleanup of agents.                                         | 5.20 (Use a container orchestrator)        | 1.1.1 (Control plane hardening)            | 5.3 (Manage workloads and nodes)           | Configure auto-scaling and automatic cleanup policies to ensure that agent resources are efficiently managed.                    | Preventive                                  | 1. Set up auto-scaling policies based on workload. 2. Implement automated cleanup of unused resources. 3. Monitor resource usage and adjust scaling policies as needed.           |
| Isolate Build Artifacts                      | Ensure build artifacts are stored securely with controlled access.                                 | 5.4 (Environment variables)                | 2.1.3 (Secure ETCD)                        | 5.1 (Secrets management)                   | Store build artifacts in secure, access-controlled storage, ensuring only authorized users and systems can retrieve them.        | Preventive                                  | 1. Store artifacts in encrypted, access-controlled storage. 2. Implement access controls to limit who can retrieve or modify artifacts. 3. Regularly audit artifact storage.      |
| Agent User Account Security                  | Run agents under dedicated service accounts with limited privileges.                               | 2.1 (Auth for Docker daemon)               | 2.2 (RBAC and namespaces)                  | 4.1 (IAM roles for service accounts)       | Use dedicated service accounts with minimal privileges for agents to reduce the risk of compromise and unauthorized access.      | Preventive                                  | 1. Create dedicated service accounts for agents. 2. Assign least privilege roles to these accounts. 3. Regularly review and adjust account permissions.                         |
| Access Controls and Audits                   | Regularly review access controls and permissions assigned to agents.                               | 5.2 (Audit logging)                        | 2.2 (RBAC and namespaces), 4.2.2 (Audit)   | 4.1 (IAM policies and roles)               | Conduct regular audits of access controls and permissions, ensuring they align with the principle of least privilege.            | Detective                                   | 1. Schedule regular access control reviews. 2. Implement audit logging for all access control changes. 3. Review audit logs to identify unauthorized access attempts.            |
| Temporary Credential Rotation                | Implement automatic rotation of temporary credentials and secrets.                                 | 3.1 (Registry authentication)              | 2.1.4 (Rotate certificates and keys)       | 5.1 (Secrets management)                   | Regularly rotate credentials and secrets used by agents to minimize the risk of exposure.                                        | Preventive                                  | 1. Implement automated tools for credential rotation. 2. Set a regular schedule for rotation. 3. Notify relevant users of credential changes. 4. Test rotated credentials.        |
| Secure Agent Startup Scripts                 | Store and manage startup scripts securely, avoid embedding sensitive info.                         | 5.4 (Environment variables)                | 5.1.5 (Limit capabilities)                 | 5.1 (Secrets management)                   | Ensure that startup scripts are stored securely and avoid hardcoding sensitive information.                                      | Preventive                                  | 1. Store startup scripts in a secure repository. 2. Use environment variables for sensitive data. 3. Regularly review and update scripts for security compliance.                |
| Secure Use of Deployment Credentials         | Ensure credentials used by agents to deploy applications are securely managed and used.            | N/A                                        | 5.4 (Limit secrets exposure)               | 5.1 (Secrets management)                   | Store deployment credentials securely and ensure they are encrypted and only accessible by authorized agents during deployment.  | Preventive                                  | 1. Store credentials in a secure, encrypted location. 2. Limit access to deployment credentials to authorized agents only. 3. Regularly rotate deployment credentials.            |
| Secure ADO Connectivity                      | Secure connectivity between Azure DevOps and agents, ensuring integrity and confidentiality.       | N/A                                        | 5.1.3 (Network policies)                   | 4.1 (IAM roles for service accounts)       | Use secure connections such as TLS/SSL between Azure DevOps and agents.                                                          | Preventive                                  | 1. Configure TLS/SSL for all ADO-agent communications. 2. Implement network policies to restrict connectivity. 3. Regularly audit and monitor ADO connectivity.                   |
| Restrict ADO Access from Agents              | Restrict agent access to Azure DevOps to only what is necessary for their specific role.           | N/A                                        | 5.1.5 (Limit capabilities)                 | 3.3.3 (Segregate environments)             | Apply access controls to ensure agents can only interact with necessary Azure DevOps components.                                 | Preventive                                  | 1. Implement RBAC for Azure DevOps. 2. Limit agent access to necessary ADO resources. 3. Regularly review and adjust access controls.                                               |
| **CI Controls**                              |                                                                                                   |                                            |                                            |                                            |                                                                                                                                  |                                             |                                                                                                                                                                                   |
| Code Integrity Validation                    | Ensure that all code checked into the CI pipeline is properly validated and verified.              | N/A                                        | 5.1.5 (Limit capabilities)                 | 5.3 (Manage workloads and nodes)           | Implement automated code validation checks in the CI pipeline.                                                                   | Preventive                                  | 1. Set up automated linting and static code analysis in the CI pipeline. 2. Implement unit testing for all code. 3. Review validation results before progressing builds.           |
| Secure Build Process                         | Protect the CI build process from tampering or unauthorized changes.                               | N/A                                        | 2.2 (RBAC and namespaces)                  | 4.1 (IAM roles for service accounts)       | Ensure that the CI pipeline is only accessible by authorized users and systems.                                                   | Preventive                                  | 1. Restrict access to CI pipeline configurations. 2. Implement RBAC to control who can modify build processes. 3. Enable audit logging for all CI-related activities.            |
| CI Pipeline Isolation                        | Isolate different CI pipelines to prevent cross-contamination of environments or projects.         | 5.20 (Use a container orchestrator)        | 2.2 (RBAC and namespaces)                  | 3.3.3 (Segregate environments)             | Segregate CI pipelines based on environment and apply strict access controls.                                                     | Preventive                                  | 1. Create isolated environments for each CI pipeline. 2. Apply RBAC to control access to each pipeline. 3. Ensure network isolation between different CI environments.           |
| CI Artifact Security                         | Secure CI artifacts to prevent unauthorized access or tampering.                                   | 5.4 (Environment variables)                | 2.1.3 (Secure ETCD)                        | 5.1 (Secrets management)                   | Store CI artifacts in secure, access-controlled storage.                                                                          | Preventive                                  | 1. Store CI artifacts in a secure, encrypted storage solution. 2. Limit access to artifacts to authorized systems and users. 3. Implement integrity checks before using artifacts. |
| **CD Controls**                              |                                                                                                   |                                            |                                            |                                            |                                                                                                                                  |                                             |                                                                                                                                                                                   |
| Secure Deployment Pipeline                   | Ensure that the CD pipeline is protected from unauthorized access or tampering.                    | N/A                                        | 2.2 (RBAC and namespaces)                  | 4.1 (IAM roles for service accounts)       | Restrict access to the CD pipeline to authorized users only.                                                                      | Preventive                                  | 1. Implement RBAC for CD pipeline access. 2. Restrict access to deployment configurations. 3. Enable audit logging for all deployment activities.                                 |
| Deployment Integrity Checks                  | Implement integrity checks to ensure that deployments are not tampered with or altered.            | N/A                                        | 5.1.5 (Limit capabilities)                 | 5.3 (Manage workloads and nodes)           | Perform checks on deployment packages or images to ensure their integrity before deploying them to production.                   | Preventive                                  | 1. Use cryptographic hashes to verify deployment artifact integrity. 2. Implement automated integrity checks in the CD pipeline. 3. Halt deployments if integrity checks fail.    |
| Rollback Capabilities                        | Ensure that rollback capabilities are in place in case of a failed or compromised deployment.      | N/A                                        | 5.1.5 (Limit capabilities)                 | 5.3 (Manage workloads and nodes)           | Implement automated rollback procedures in the CD pipeline.                                                                        | Preventive                                  | 1. Store previous deployment versions securely. 2. Implement automated rollback scripts in the CD pipeline. 3. Test rollback procedures regularly to ensure they work as expected.|
| Secure Configuration Management              | Ensure that all configuration changes in the CD pipeline are securely managed and audited.         | N/A                                        | 5.1.5 (Limit capabilities)                 | 4.1 (IAM roles for service accounts)       | Use version-controlled configuration management tools.                                                                            | Preventive                                  | 1. Implement version control for all deployment configurations. 2. Restrict who can make configuration changes. 3. Enable audit logging for all configuration changes.            |

### Explanation:

1. **Preventive Controls:** These controls are implemented to prevent security incidents before they occur. For example, restricting access to CI/CD pipelines is a preventive measure.

2. **Detective Controls:** These controls are designed to detect security incidents after they have occurred. For example, logging and monitoring activities allow you to detect unauthorized access or modifications.

3. **Steps for Implementation:** This column provides actionable steps for implementing each control, ensuring that they are practical and tailored to secure CI/CD pipelines in environments such as EKS, EC2, and Azure DevOps.
